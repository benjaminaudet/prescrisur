<div class="row" id="page-header">
	<h1>{{ pathology.name }}</h1>
</div>

<div id="content" class="row caduceus">
	<flash-message duration="4000" show-close="true"></flash-message>

	<div id="sidebar" class="col-md-3 col-md-push-9">
		<h2>Infos & Médicaments</h2>
		<div ng-click="toggleShowAll()" type="button" class="btn btn-default" ng-switch="foldAll">
			<span ng-switch-when="true">
				<i class="fa fa-compress"></i>
				Tout Replier
			</span>
			<span ng-switch-default>
				<i class="fa fa-expand"></i>
				Tout Déplier
			</span>
		</div>
		<div ng-if="isAuthorized('admin')">
			<h2>Admin</h2>
			<div id="print-patho" class="btn btn-default" ng-click="print()">
				<i class="fa fa-print"></i>
				Imprimer la Pathologie
			</div>
			<div class="btn-group" role="group">
				<a ui-sref="pathologies.edit({id: pathology._id})" type="button" class="btn btn-default">
					<i class="fa fa-edit"></i>
					Modifier
				</a>
				<a ng-click="delete()" type="button" class="btn btn-danger">
					<i class="fa fa-trash"></i>
					Supprimer
				</a>
			</div>
		</div>
		<h2 id="updated-title">Dernière Mise à Jour</h2>
		<span class="updated">{{ pathology.updated_at | timeAgo }}</span>
		<h2>
			Sommaire
			<button class="summary-toggle visible-xs-inline" data-toggle="collapse" data-target=".summary-collapse">
				<i class="fa fa-caret-down"></i>
			</button>
		</h2>
		<ul id="pathology-summary" class="summary-collapse collapse">
			<li ng-repeat="data in pathology.levels" ng-include="'patho-summary-tree.html'" depth="1"></li>
		</ul>
	</div>

	<div id="pathology" class="col-md-9 col-md-pull-3">
		<div id="intro" class="text" ng-if="pathology.intro" ng-bind-html="pathology.intro"></div>
		<div class="pathology-tree">
			<div ng-repeat="data in pathology.levels" ng-include="'patho-tree.html'" class="level" depth="1"></div>
		</div>
		<div id="conclu" class="text" ng-if="pathology.conclu" ng-bind-html="pathology.conclu"></div>
	</div>
</div>

<!-- Pathology Tree Template -->
<script type="text/ng-template"  id="patho-tree.html">
	<div class="level-header" id="{{ data.rank }}{{ $index + 1 }}.">
		<level-title title="{{ data.name }}" rank="{{ data.rank }}{{ $index + 1 }}." depth="{{ data.depth }}"></level-title>
	</div>
	<div class="text level-text" ng-if="data.text" ng-bind-html="data.text"></div>

	<div ng-if="data.levels && data.levels.length > 0">
		<div ng-repeat="data in data.levels" ng-include="'patho-tree.html'" class="level" depth="{{ data.depth }}"></div>
	</div>

	<table class="entries table table-curved" ng-if="data.entries && data.entries.length > 0">
		<tr ng-repeat-start="entry in data.entries">
			<td class="reco" ng-switch="entry.reco._id">
				<div ng-switch-when="none"></div>
				<div ng-switch-default="" uib-tooltip="{{ entry.reco.name }}">
					<img ng-src="front/assets/img/gelule_{{ entry.reco._id }}_mini.png" alt="{{ entry.reco._id }}" />
				</div>
			</td>
			<td class="product">
				{{ entry.product.name }} <span class="spec-status">{{ entry.product.status }}</span>
			</td>
			<td class="more-info" ng-switch="entry.type" colspan="{{ entryColspan(entry) }}">
				<div ng-switch-when="specialities">
					<a ui-sref="specialities({id: entry.product._id})" target="_blank">RCP ANSM/EMEA</a>
				</div>
				<div ng-switch-default="">
					<a ng-model="entry.displaySpecialities" uib-btn-checkbox>Liste des médicaments</a>
				</div>
			</td>
			<td ng-if="entry.info" class="info-button" ng-class="{'active':entry.displayInfo}">
				<div ng-model="entry.displayInfo" uib-btn-checkbox>Info*</div>
			</td>
		</tr>
		<tr ng-show="entry.displayInfo">
			<td colspan="5">
				<span class="bold">Info:</span>
				<span ng-bind-html="entry.info"></span>
			</td>
		</tr>
		<tr ng-show="entry.displaySpecialities" ng-repeat-end>
			<td colspan="5">
				<div class="speciality" ng-repeat="spec in entry.product.specialities" ng-if="spec.enabled">
					<a ui-sref="specialities({id: spec._id})" target="_blank">{{ spec.name }}</a>
					<span class="spec-status">{{ spec.status }}</span>
				</div>
			</td>
		</tr>
	</table>
</script>

<!-- Pathology Summary Tree Template -->
<script type="text/ng-template"  id="patho-summary-tree.html">
	<a class="pointer" ng-click="scrollTo(data.rank, $index)">{{ data.rank }}{{ $index + 1 }}. {{ data.name }}</a>

	<ul ng-if="data.levels && data.levels.length > 0">
		<li ng-repeat="data in data.levels" ng-include="'patho-summary-tree.html'" depth="{{ data.depth }}"></li>
	</ul>
</script>